<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <!-- FullCalendar CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.css" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      position: relative;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 20px;
      text-align: center;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .nav-tab {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1em;
    }

    .nav-tab:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .nav-tab.active {
      background: rgba(255, 255, 255, 0.4);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      transition: transform 0.3s ease;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
    }

    .dashboard-card i {
      font-size: 3em;
      margin-bottom: 15px;
      opacity: 0.8;
    }

    .dashboard-card h3 {
      font-size: 1.2em;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .dashboard-card .number {
      font-size: 3em;
      font-weight: bold;
      color: #fff;
    }

    /* Reservations Layout */
    .reservations-layout {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 20px;
      align-items: start;
    }

    .mini-calendar {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px;
      position: sticky;
      top: 20px;
    }

    .mini-calendar h3 {
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.1em;
      opacity: 0.9;
    }

    .mini-calendar .fc {
      font-size: 0.85em;
    }

    .mini-calendar .fc-toolbar {
      margin-bottom: 10px;
    }

    .mini-calendar .fc-toolbar-title {
      font-size: 1.1em;
    }

    .mini-calendar .fc-button {
      padding: 2px 6px;
      font-size: 0.8em;
    }

    .reservations-content {
      min-height: 400px;
    }

    .reservations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .reservation-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      transition: transform 0.3s ease;
    }

    .reservation-card:hover {
      transform: translateY(-3px);
    }

    .reservation-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 15px;
      margin-bottom: 15px;
    }

    .reservation-header h4 {
      font-size: 1.3em;
      margin: 0;
    }

    .reservation-details {
      margin-bottom: 15px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      align-items: center;
    }

    .detail-label {
      font-weight: 600;
      opacity: 0.8;
      min-width: 100px;
    }

    .detail-value {
      text-align: right;
      flex: 1;
    }

    .comment-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 0.9em;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .status-approved {
      background: rgba(46, 204, 113, 0.3);
      color: #2ecc71;
    }

    .status-rejected {
      background: rgba(231, 76, 60, 0.3);
      color: #e74c3c;
    }

    .status-pending {
      background: rgba(241, 196, 15, 0.3);
      color: #f1c40f;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      min-width: 80px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .btn-approve {
      background: #27ae60;
      color: white;
    }

    .btn-approve:hover {
      background: #2ecc71;
    }

    .btn-reject {
      background: #c0392b;
      color: white;
    }

    .btn-reject:hover {
      background: #e74c3c;
    }

    .btn-delete {
      background: #8e44ad;
      color: white;
    }

    .btn-delete:hover {
      background: #9b59b6;
    }

    .btn-assign {
      background: #3498db;
      color: white;
    }

    .btn-assign:hover {
      background: #2980b9;
    }

    /* Staff assignment in reservation cards */
    .staff-assignment {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
    }

    .staff-select {
      width: 100%;
      padding: 5px 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 0.9em;
    }

    .staff-select option {
      background: #333;
      color: white;
    }

    .assigned-staff {
      margin-top: 8px;
      padding: 5px 8px;
      background: rgba(52, 152, 219, 0.3);
      border-radius: 5px;
      font-size: 0.85em;
      color: #3498db;
    }

    /* Calendar styles */
    .fc {
      background: transparent;
    }

    .fc-theme-standard .fc-scrollgrid {
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .fc-theme-standard td, .fc-theme-standard th {
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .fc-col-header-cell {
      background: rgba(255, 255, 255, 0.1);
    }

    .fc-daygrid-day {
      background: rgba(255, 255, 255, 0.05);
    }

    .fc-daygrid-day:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .fc-day-today {
      background: rgba(255, 255, 255, 0.15) !important;
    }

    .fc-button {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
    }

    .fc-button:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .fc-button:disabled {
      background: rgba(255, 255, 255, 0.1);
      opacity: 0.6;
    }

    .fc-toolbar-title {
      color: white;
    }

    .fc-col-header-cell-cushion {
      color: white;
    }

    .fc-daygrid-day-number {
      color: rgba(255, 255, 255, 0.8);
    }

    .fc-event-approved {
      background-color: rgba(46, 204, 113, 0.8);
      border-color: #2ecc71;
    }

    .fc-event-rejected {
      background-color: rgba(231, 76, 60, 0.8);
      border-color: #e74c3c;
    }

    .fc-event-pending {
      background-color: rgba(241, 196, 15, 0.8);
      border-color: #f1c40f;
    }

    /* Staff Management Styles */
    .staff-management-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .staff-form, .staff-list {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
    }

    .staff-form h3, .staff-list h3 {
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.4em;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      opacity: 0.9;
    }

    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 1em;
    }

    .form-control:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.15);
    }

    .form-control::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .btn-primary {
      background: #3498db;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
      transition: background 0.3s ease;
    }

    .btn-primary:hover {
      background: #2980b9;
    }

    .staff-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .staff-info {
      flex: 1;
    }

    .staff-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .staff-role {
      font-size: 0.9em;
      opacity: 0.8;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 0.8em;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      margin-left: 5px;
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .nav-tabs {
        justify-content: center;
      }

      .nav-tab {
        padding: 10px 15px;
        font-size: 0.9em;
      }

      .reservations-layout {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .mini-calendar {
        position: static;
      }

      .reservations-grid {
        grid-template-columns: 1fr;
      }

      .dashboard-cards {
        grid-template-columns: 1fr;
      }

      .staff-management-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn {
        min-width: 100%;
        margin-bottom: 5px;
      }
    }

    @media (max-width: 480px) {
      .reservations-layout {
        grid-template-columns: 1fr;
      }
      
      .mini-calendar {
        order: 2;
        margin-top: 20px;
      }
      
      .reservations-content {
        order: 1;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-tachometer-alt"></i> Admin</h1>
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchPage('dashboard')">
          <i class="fas fa-chart-line"></i> Dashboard
        </button>

        <button class="nav-tab" onclick="switchPage('reservations')">
          <i class="fas fa-calendar-alt"></i> Reservations
        </button>

        <button class="nav-tab" onclick="switchPage('staff-management')">
          <i class="fas fa-users"></i> Staff Management
        </button>
      </div>
      <!-- Logout button -->
      <button onclick="logout()" style="position: absolute; bottom: 20px; right: 20px; padding: 8px 15px; background: #e74c3c; border: none; border-radius: 5px; color: white; cursor: pointer; z-index: 1000;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard" class="page active">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <i class="fas fa-check-circle"></i>
          <h3>Total Events Approved</h3>
          <div class="number" id="approvedCount">0</div>
        </div>
        <div class="dashboard-card">
          <i class="fas fa-clock"></i>
          <h3>Pending Approval</h3>
          <div class="number" id="pendingCount">0</div>
        </div>
        <div class="dashboard-card">
          <i class="fas fa-calendar-check"></i>
          <h3>Total Reservations</h3>
          <div class="number" id="totalCount">0</div>
        </div>
        <div class="dashboard-card">
          <i class="fas fa-users"></i>
          <h3>Total Staff</h3>
          <div class="number" id="staffCount">0</div>
        </div>
      </div>
    </div>

    <!-- Reservations Page -->
    <div id="reservations" class="page">
      <div class="reservations-layout">
        <!-- Mini Calendar Sidebar -->
        <div class="mini-calendar">
          <h3><i class="fas fa-calendar-alt"></i> Event Overview</h3>
          <div id="mini-calendar"></div>
        </div>

        <!-- Reservations Content -->
        <div class="reservations-content">
          <div class="reservations-grid">
            <!-- Reservations will be dynamically populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Staff Management Page -->
    <div id="staff-management" class="page">
      <div class="staff-management-container">
        <!-- Add Staff Form -->
        <div class="staff-form">
          <h3><i class="fas fa-user-plus"></i> Add New Staff</h3>
          <form id="addStaffForm">
            <div class="form-group">
              <label for="staffName"><i class="fas fa-user"></i> Staff Name</label>
              <input type="text" id="staffName" class="form-control" placeholder="Enter staff name" required>
            </div>
            <div class="form-group">
              <label for="staffRole"><i class="fas fa-briefcase"></i> Role</label>
              <input type="text" id="staffRole" class="form-control" placeholder="e.g. Event Coordinator, Photographer" required>
            </div>
            <div class="form-group">
              <label for="staffEmail"><i class="fas fa-envelope"></i> Email</label>
              <input type="email" id="staffEmail" class="form-control" placeholder="staff@example.com" required>
            </div>
            <div class="form-group">
              <label for="staffPhone"><i class="fas fa-phone"></i> Phone</label>
              <input type="tel" id="staffPhone" class="form-control" placeholder="+1234567890">
            </div>
            <button type="submit" class="btn-primary">
              <i class="fas fa-plus"></i> Add Staff Member
            </button>
          </form>
        </div>

        <!-- Staff List -->
        <div class="staff-list">
          <h3><i class="fas fa-users"></i> Staff Members</h3>
          <div id="staffListContainer">
            <!-- Staff list will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <!-- FullCalendar JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBqvRVs2TMAmKrAz16cojV-ro89kbr65tg",
      authDomain: "fire-setup-reservation.firebaseapp.com",
      projectId: "fire-setup-reservation",
      storageBucket: "fire-setup-reservation.firebasestorage.app",
      messagingSenderId: "21283314883",
      appId: "1:21283314883:web:3f4377257e4ed40f421676"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let reservations = [];
    let staff = [];
    let miniCalendar;

    // Protect admin page
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "admin-login.html";
      } else {
        console.log("âœ… Admin logged in:", user.email);
        initializeMiniCalendar();
        listenReservations();
        listenStaff();
      }
    });

    function logout() {
      auth.signOut().then(() => {
        window.location.href = "admin-login.html";
      });
    }

    function initializeMiniCalendar() {
      const calendarEl = document.getElementById('mini-calendar');
      
      miniCalendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev',
          center: 'title',
          right: 'next'
        },
        height: 300,
        events: [],
        eventDidMount: function(info) {
          const status = info.event.extendedProps.status;
          info.el.classList.add(`fc-event-${status}`);
        }
      });
      
      miniCalendar.render();
    }

    function listenReservations() {
      db.collection("reservations")
        .orderBy("createdAt", "desc")
        .onSnapshot(snapshot => {
          reservations = [];
          snapshot.forEach(doc => {
            reservations.push({ id: doc.id, ...doc.data() });
          });
          renderReservations();
          updateMiniCalendarEvents();
          updateDashboardStats();
        }, err => {
          console.error("Snapshot error:", err);
        });
    }

    function listenStaff() {
      db.collection("staff")
        .orderBy("createdAt", "desc")
        .onSnapshot(snapshot => {
          staff = [];
          snapshot.forEach(doc => {
            staff.push({ id: doc.id, ...doc.data() });
          });
          renderStaffList();
          updateDashboardStats();
        }, err => {
          console.error("Staff snapshot error:", err);
        });
    }

    function updateMiniCalendarEvents() {
      if (!miniCalendar) return;

      const events = reservations
        .filter(reservation => reservation.date && reservation.eventType)
        .map(reservation => {
          const date = parseFirebaseDate(reservation.date);
          if (!date) return null;

          const title = reservation.eventType.substring(0, 15) + (reservation.eventType.length > 15 ? '...' : '');

          return {
            id: reservation.id,
            title: title,
            start: date,
            allDay: true,
            extendedProps: {
              status: reservation.status || 'pending'
            }
          };
        })
        .filter(event => event !== null);

      miniCalendar.removeAllEvents();
      miniCalendar.addEventSource(events);
    }

    function parseFirebaseDate(dateField) {
      if (!dateField) return null;
      
      try {
        if (dateField.toDate) {
          return dateField.toDate();
        }
        if (dateField.seconds) {
          return new Date(dateField.seconds * 1000);
        }
        if (typeof dateField === 'string') {
          return new Date(dateField);
        }
        return new Date(dateField);
      } catch (error) {
        console.error('Error parsing date:', error);
        return null;
      }
    }

    function formatDate(timestamp) {
      if (!timestamp) return '';
      if (timestamp.toDate) return timestamp.toDate().toLocaleDateString();
      if (timestamp.seconds) return new Date(timestamp.seconds * 1000).toLocaleDateString();
      return new Date(timestamp).toLocaleDateString();
    }

    function switchPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById(page).classList.add('active');
      event.target.classList.add('active');

      if (page === 'reservations' && miniCalendar) {
        setTimeout(() => {
          miniCalendar.updateSize();
        }, 100);
      }
    }

    function updateDashboardStats() {
      const approved = reservations.filter(r => r.status === 'approved').length;
      const pending = reservations.filter(r => r.status === 'pending').length;
      const total = reservations.length;
      const totalStaff = staff.length;
      
      document.getElementById('approvedCount').textContent = approved;
      document.getElementById('pendingCount').textContent = pending;
      document.getElementById('totalCount').textContent = total;
      document.getElementById('staffCount').textContent = totalStaff;
    }

    function updateStatus(reservationId, newStatus) {
      db.collection("reservations").doc(reservationId).update({
        status: newStatus,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        console.log(`Reservation ${reservationId} updated to ${newStatus}`);
      }).catch(err => console.error(err));
    }

    function deleteReservation(reservationId) {
      if (confirm('Are you sure you want to delete this reservation?')) {
        db.collection("reservations").doc(reservationId).delete()
          .then(() => {
            console.log("Deleted:", reservationId);
          })
          .catch(err => console.error(err));
      }
    }

    function assignStaff(reservationId, staffId) {
      if (!staffId) return;
      
      const selectedStaff = staff.find(s => s.id === staffId);
      if (selectedStaff) {
        db.collection("reservations").doc(reservationId).update({
          assignedStaff: {
            id: staffId,
            name: selectedStaff.name,
            role: selectedStaff.role
          },
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          console.log(`Staff assigned to reservation ${reservationId}`);
        }).catch(err => console.error(err));
      }
    }

    function getStatusClass(status) {
      switch (status) {
        case 'approved': return 'status-approved';
        case 'rejected': return 'status-rejected';
        default: return 'status-pending';
      }
    }

    function getStatusIcon(status) {
      switch (status) {
        case 'approved': return 'check';
        case 'rejected': return 'times';
        default: return 'clock';
      }
    }

    function renderReservations() {
      const container = document.querySelector('.reservations-grid');
      if (reservations.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: white; font-size: 1.2em; grid-column: 1 / -1;"><i class="fas fa-calendar-times" style="font-size: 3em; margin-bottom: 20px; opacity: 0.5;"></i><br>No reservations found</div>';
        return;
      }

      container.innerHTML = reservations.map(reservation => {
        const name = reservation.name || "-";
        const eventType = reservation.eventType || "-";
        const email = reservation.email || "-";
        const date = reservation.date ? formatDate(reservation.date) : "-";
        const timeFrom = reservation.timeFrom || "-";
        const timeTo = reservation.timeTo || "-";
        const comments = reservation.comments || "";
        const status = reservation.status || "pending";
        const assignedStaff = reservation.assignedStaff;

        // Only show staff assignment for approved reservations
        const staffAssignmentSection = status === 'approved' ? `
          <div class="staff-assignment">
            <strong><i class="fas fa-user-tie"></i> Assign Staff:</strong>
            <select class="staff-select" onchange="assignStaff('${reservation.id}', this.value)">
              <option value="">Select Staff Member</option>
              ${staff.map(s => `<option value="${s.id}" ${assignedStaff && assignedStaff.id === s.id ? 'selected' : ''}>${s.name} - ${s.role}</option>`).join('')}
            </select>
            ${assignedStaff ? `<div class="assigned-staff"><i class="fas fa-check"></i> Assigned to: ${assignedStaff.name} (${assignedStaff.role})</div>` : ''}
          </div>
        ` : '';

        return `
          <div class="reservation-card">
            <div class="reservation-header">
              <h4><i class="fas fa-user"></i> ${name}</h4>
            </div>
            <div class="reservation-details">
              <div class="detail-row"><span class="detail-label"><i class="fas fa-calendar"></i> Event:</span> <span class="detail-value">${eventType}</span></div>
              <div class="detail-row"><span class="detail-label"><i class="fas fa-envelope"></i> Email:</span> <span class="detail-value">${email}</span></div>
              <div class="detail-row"><span class="detail-label"><i class="fas fa-calendar-day"></i> Date:</span> <span class="detail-value">${date}</span></div>
              <div class="detail-row"><span class="detail-label"><i class="fas fa-clock"></i> Time:</span> <span class="detail-value">${timeFrom} - ${timeTo}</span></div>
            </div>
            ${comments ? `<div class="comment-section"><strong><i class="fas fa-comment"></i> Comment:</strong><br>${comments}</div>` : ''}
            <div class="status-badge ${getStatusClass(status)}">
              <i class="fas fa-${getStatusIcon(status)}"></i> ${status.toUpperCase()}
            </div>
            ${staffAssignmentSection}
            <div class="action-buttons">
              <button class="btn btn-approve" onclick="updateStatus('${reservation.id}', 'approved')"><i class="fas fa-check"></i> Approve</button>
              <button class="btn btn-reject" onclick="updateStatus('${reservation.id}', 'rejected')"><i class="fas fa-times"></i> Reject</button>
              <button class="btn btn-delete" onclick="deleteReservation('${reservation.id}')"><i class="fas fa-trash"></i> Delete</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Staff Management Functions
    function addStaff(event) {
      event.preventDefault();
      
      const name = document.getElementById('staffName').value.trim();
      const role = document.getElementById('staffRole').value.trim();
      const email = document.getElementById('staffEmail').value.trim();
      const phone = document.getElementById('staffPhone').value.trim();

      if (!name || !role || !email) {
        alert('Please fill in all required fields');
        return;
      }

      db.collection("staff").add({
        name: name,
        role: role,
        email: email,
        phone: phone,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        console.log("Staff member added successfully");
        document.getElementById('addStaffForm').reset();
      }).catch(error => {
        console.error("Error adding staff:", error);
        alert('Error adding staff member. Please try again.');
      });
    }

    function deleteStaff(staffId) {
      if (confirm('Are you sure you want to delete this staff member?')) {
        db.collection("staff").doc(staffId).delete()
          .then(() => {
            console.log("Staff deleted:", staffId);
          })
          .catch(err => {
            console.error("Error deleting staff:", err);
            alert('Error deleting staff member. Please try again.');
          });
      }
    }

    function renderStaffList() {
      const container = document.getElementById('staffListContainer');
      if (staff.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: white; opacity: 0.7; padding: 20px;"><i class="fas fa-users" style="font-size: 2em; margin-bottom: 10px; opacity: 0.5;"></i><br>No staff members found</div>';
        return;
      }

      container.innerHTML = staff.map(member => `
        <div class="staff-item">
          <div class="staff-info">
            <div class="staff-name"><i class="fas fa-user"></i> ${member.name}</div>
            <div class="staff-role">${member.role}</div>
            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.8;">
              <i class="fas fa-envelope"></i> ${member.email}
              ${member.phone ? `<br><i class="fas fa-phone"></i> ${member.phone}` : ''}
            </div>
          </div>
          <div>
            <button class="btn-small btn-danger" onclick="deleteStaff('${member.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    // Event Listeners
    document.getElementById('addStaffForm').addEventListener('submit', addStaff);

    // Function to receive data from Flutter WebView (if needed)
    function receiveFromFlutter(data) {
      try {
        const parsedData = JSON.parse(data);
        console.log('Received data from Flutter:', parsedData);
        
        if (parsedData.action === 'switchPage') {
          switchPage(parsedData.page);
        }
      } catch (error) {
        console.error('Error parsing Flutter data:', error);
      }
    }

    // Make function globally available for Flutter WebView
    window.receiveFromFlutter = receiveFromFlutter;
  </script>
</body>
</html>